{{ with (templates.Defer (dict "key" "global")) }}
  {{ with resources.Get "css/main.css" }}
    {{ $opts := dict
      "minify" hugo.IsProduction
      "inlineImports" true
    }}
    {{ with . | css.TailwindCSS $opts }}
      {{ if hugo.IsProduction }}
        {{ with . | fingerprint }}
          <link rel="stylesheet" href="{{ .RelPermalink }}" integrity="{{ .Data.Integrity }}" crossorigin="anonymous">
        {{ end }}
      {{ else }}
        <link rel="stylesheet" href="{{ .RelPermalink }}">
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}

<!-- Tailwind CSS -->
{{/* assets/css/main.css を直接取得し、失敗した場合は空のリソースを返すように安全策を設ける */}}
{{ $css := resources.Get "css/main.css" }}
{{ if $css }}
  {{ $styles := $css | resources.Minify | fingerprint }}
  <link rel="stylesheet" href="{{ $styles.RelPermalink }}" media="screen" integrity="{{ $styles.Data.Integrity }}">
{{ else }}
  {{/* もしHugoがリソースとして認識できない場合は、直接パスを指定する（フォールバック） */}}
  <link rel="stylesheet" href="{{ "css/main.css" | relURL }}">
{{ end }}

<!-- Code Highlighting (switchable themes) -->
<link id="hljs-theme-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
<link id="hljs-theme-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
<script>
  (function(){
    try{
      var t = localStorage.getItem('theme');
      var dark = t ? (t === 'dark') : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches);
      var l = document.getElementById('hljs-theme-light');
      var d = document.getElementById('hljs-theme-dark');
      if(l && d){ l.disabled = dark; d.disabled = !dark; }
    }catch(e){}
  })();
  </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

<!-- Responsive Font Support -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
